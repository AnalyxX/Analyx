<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>empresa</title>
  <link rel="stylesheet" href="../assets/css/maquina/maquinaa.css" />
</head>

<body>
  <section>

    <div class="navBarLateral">

      <div class="user">
        <div class="fotoUser">
        </div>
        <h2 id="NomeUsuario">Nome Usuário</h2>
      </div>
      <div class="navegarLeteral">
        <li> <a href="../crud_empresa/empresa.html">EMPRESA</a></li>
        <li id="aqui">MÁQUINA</a></li>
        <li><a href="../crud_funcionario/cadastrarFuncionario.html">FUNCIONÁRIO</a></li>
        <li><a href="../crud_usuario/cadastro-user.html"> USUÁRIO</a></li>
      </div>
      <div class="sair" onclick="sair()"><span>Sair</span></div>
    </div>

    <div class="areaPrincipal">
      <header>
        <nav>
          <ul>
            <li id="cadMaq" style="display:none"><a onclick="cadastrarMAQ()">Cadastrar Maquina</a></li>
            <li id="aqui2"><a style="display:block">Cadastrar Maquina</a></li>
            <li id="altMaq" style="display: block;"><a onclick="alterarMAQ()"> Alterar Maquina</a></li>
            <li id="aqui3" style="display: none;"><a>Alterar Maquina</a></li>
            <li id="listMaq" style="display: none;"><a onclick="listarMAQ()">Listar Maquina</a></li>
            <li id="aqui4" style="display: none;"><a>Listar Maquina</a></li>
            <li id="deletMaq" style="display: none;"><a onclick="deletarMAQ()">Deletar Maquina</a></li>
            <li id="aqui5" style="display: none;"><a>Deletar Maquina</a></li>
          </ul>
        </nav>
      </header>

      <div class="areaTitulo">

        <div id="tituloCAD" class="titulo">
          <h1>Especificações Máquina</h1>
        </div>

        <div id="tituloALT" class="titulo" style="display: none;">
          <h1>Buscar Máquina</h1>
        </div>
        <div id="tituloLIST" class="titulo" style="display: none;">
          <h1>Listagem de Máquinas</h1>
        </div>
        <div id="tituloDELET" class="titulo" style="display: none;">
          <h1>Deletar Máquina</h1>
        </div>

      </div>


      <div id="cadastroMaq" class="cadastro-maq" style="display:block;">
        <div class="input" id="ipt-1">
            CPU
            <input type="text" name="nome" id="ipt_cnpj" />
          </div>
          <div class="input" id="ipt-2">
            RAM
            <input type="text" name="matricula" id="ipt_razaoSocial" />
          </div>
          <div class="input" id="ipt-3">
            DISCO
            <input type="text" name="setor" id="ipt_responsavel" />
          </div>
          <div class="input" id="ipt-4">
            Número Serial
            <input type="text" name="maquina" id="ipt_email" />
          </div>
        <button id="btn_entrar" onclick="cadastrar()">Cadastrar</button>
      </div>


      <div id="alterarMaq" class="alterar-maq" style="display:none;">
        <div class="input2" id="ipt-1">
          Número Serial:
          <input type="text" name="nome" id="Alt_cnpj" />
          <button id="btn_entrar" onclick="aparecerBuscados()">Buscar</button>
        </div>
      </div>


      <div id="alterarMaq2" class="alterar-maq2" style="display:none;">
        <div class="input3" id="ipt-1">
          CPU
          <input type="text" name="nome" placeholder="Altere o CNPJ" id="ipt_nome" />
        </div>
        <div class="input3" id="ipt-2">
          RAM
          <input type="text" name="matricula" placeholder="Altere a Razão Social" id="ipt_matricula" />
        </div>
        <div class="input3" id="ipt-3">
          DISCO
          <input type="text" name="setor" placeholder="Altere o Responsável" id="ipt_setor" />
        </div>
        <div class="input3" id="ipt-4">
          Número Serial
          <input type="text" name="maquina" placeholder="Altere o Email" id="ipt_maquina" />
        </div>
        <button id="btn_entrar" onclick="aparecerBuscados()">Alterar</button>
      </div>



      <div id="listarMaq" class="listar-maq" style="display:none;">
        <div class="input" id="ipt-1">
          Foram encontradas:
        </div>
        <div>000.012.0043

        </div>

      </div>
      <div id="listarMaq2" class="listar-maq" style="display:none;">
        <div class="input" id="ipt-1">
          CNPJ
          <input type="text" name="nome" id="ipt_nome" />
          <div class="input" id="ipt-2">
            Razão social
            <input type="text" name="matricula" id="ipt_matricula" />
          </div>
          <div class="input" id="ipt-3">
            Responsavel
            <input type="text" name="setor" id="ipt_setor" />
          </div>
          <div class="input" id="ipt-4">
            E-mail
            <input type="text" name="maquina" id="ipt_maquina" />
          </div>
          <div class="input" id="ipt-5">
            Telefone
            <input type="text" name="funcao" id="ipt_funcao" />
          </div>
        </div>

      </div>


      <div id="deletarMaq" class="deletar-maq" style="display:none;">
        <div id="buscarDelete" style="display:block;">
          <div class="input" id="ipt-1">
            CNPJ
            <input type="text" name="nome" id="ipt_nome" />
          </div>
          <button id="btn_entrar" onclick="aparecerDelete()">Cadastrar</button>
        </div>

        <div id="deletarMaq2" class="deletarMaq2" style="display:none;">
          <h3>Tem certeza que deseja excluir essa empresa ?</h3>
          <li>CNPJ:</li>
          <li>Razão social:</li>
          <li>Responsável:</li>
          <li>E-mail::</li>
          <li>Telefone:</li>
          <div class="SimNao">
            <li>Sim</li>
            <li>Não</li>
          </div>
        </div>
      </div>
    </div>



  </section>
</body>

</html>
<script>  
  var EmailUsuario ="";
  var NomeUsuario ="";
  sessionStorage.EMAIL_USUARIO = EmailUsuario;

  sessionStorage.NOME_USUARIO = NomeUsuario;

  function sair(){
    window.location = "../index.html";

  }
  

  function alterarMAQ() {
    if(EmailUsuario == "Analyx@"){
      //header
    aqui2.style.display = "none";
    aqui4.style.display = "none";
    aqui5.style.display = "none";
    altMaq.style.display = "none";

    deletMaq.style.display = "block";
    listMaq.style.display = "block";
    cadMaq.style.display = "block";

    aqui3.style.display = "block";

    //social
    cadastroMaq.style.display = "none";
    listarMaq.style.display = "none";
    deletarMaq.style.display = "none";
    alterarMaq2.style.display = "none";


    alterarMaq.style.display = "block";

    //titulo
    tituloCAD.style.display = "none";
    tituloALT.style.display = "block";
    tituloLIST.style.display = "none";
    tituloDELET.style.display = "none";
    }else{
          //header
          aqui2.style.display = "none";
          aqui4.style.display = "none";
          aqui5.style.display = "none";
          altMaq.style.display = "none";
      
          deletMaq.style.display = "none";
          listMaq.style.display = "none";
          cadMaq.style.display = "block";
      
          aqui3.style.display = "block";
  
      //social
      cadastroMaq.style.display = "none";
      alterarMaq2.style.display = "none";
  
  
      alterarMaq.style.display = "block";
  
      //titulo
      tituloCAD.style.display = "none";
      tituloALT.style.display = "block";
    }

  }
  function cadastrarMAQ() {
    if(EmailUsuario == "Analyx@"){
      //header
    aqui3.style.display = "none";
    aqui4.style.display = "none";
    aqui5.style.display = "none";
    cadMaq.style.display = "none";

    altMaq.style.display = "block";
    listMaq.style.display = "block";
    deletMaq.style.display = "block";

    aqui2.style.display = "block";

    //social
    alterarMaq.style.display = "none";
    listarMaq.style.display = "none";
    deletarMaq.style.display = "none";
    alterarMaq2.style.display = "none";

    cadastroMaq.style.display = "block";

    //titulo
    tituloCAD.style.display = "block";
    tituloALT.style.display = "none";
    tituloLIST.style.display = "none";
    tituloDELET.style.display = "none";
    }else{
      //header
      aqui3.style.display = "none";
      aqui4.style.display = "none";
      aqui5.style.display = "none";
      cadMaq.style.display = "none";
  
      altMaq.style.display = "block";
      listMaq.style.display = "none";
      deletMaq.style.display = "none";
  
      aqui2.style.display = "block";
  
      //social
      alterarMaq.style.display = "none";
      listarMaq.style.display = "none";
      deletarMaq.style.display = "none";
      alterarMaq2.style.display = "none";
  
      cadastroMaq.style.display = "block";
  
      //titulo
      tituloCAD.style.display = "block";
      tituloALT.style.display = "none";
      tituloLIST.style.display = "none";
      tituloDELET.style.display = "none";
    }
  }

  function listarMAQ() {
    //header
    aqui2.style.display = "none";
    aqui3.style.display = "none";
    aqui5.style.display = "none";
    listMaq.style.display = "none";

    cadMaq.style.display = "block";
    altMaq.style.display = "block";
    deletMaq.style.display = "block";

    aqui4.style.display = "block";


    //social
    cadastroMaq.style.display = "none";
    alterarMaq.style.display = "none";
    deletarMaq.style.display = "none";
    alterarMaq2.style.display = "none";


    listarMaq.style.display = "block";

    //titulo
    tituloCAD.style.display = "none";
    tituloALT.style.display = "none";
    tituloLIST.style.display = "block";
    tituloDELET.style.display = "none";
  }

  function deletarMAQ() {
    //header
    aqui2.style.display = "none";
    aqui3.style.display = "none";
    aqui4.style.display = "none";
    deletMaq.style.display = "none";

    cadMaq.style.display = "block";
    altMaq.style.display = "block";
    listMaq.style.display = "block";

    aqui5.style.display = "block";

    //social
    cadastroMaq.style.display = "none";
    alterarMaq.style.display = "none";
    listarMaq.style.display = "none";
    alterarMaq2.style.display = "none";


    deletarMaq.style.display = "block";


    //titulo
    tituloCAD.style.display = "none";
    tituloALT.style.display = "none";
    tituloLIST.style.display = "none";
    tituloDELET.style.display = "block";

  }


  function aparecerDelete() {
    deletarMaq2.style.display = "block";
    buscarDelete.style.display = "none";
  }

  function cadastrar() {
    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo
    var cpu = ipt_cpu.value;
    var ram = ipt_ram.value;
    var disco = ipt_disco.value;
    var numeroSerial = ipt_serial.value;
    var ax_erro = false


    if (cpu == "" || ram == "" || disco == "" || serial == "") {
      //cardErro.style.display = "block"
      alert("Por favor, preencha todos os campos!")
      if (ipt_nome.length > 10) {
        alert("Escreva um nome mais curto")
      }
      // mensagem_erro= ("") 
      //finalizarAguardar();
      return false;
    } else if (ipt_cpu.value.length < 10) {
      alert("CNPJ invalido!")
    } else if (email.indexOf('@') == -1 || email.length <= 10) {
      alert("Insira um email com @ ou mais longo!")
    } else if (razaoSocial.length <= 2 && razaoSocial.length >= 25) {
      alert("Razao social não pode ser muito curta ou muito longa")
    } else if (responsavel.length < 3 && responsavel.length > 25) {
      alert("Razao social não pode ser muito curta ou muito longa!")
    } else if (email.length < 6) {
      alert("Email muito curto!")
    } else if (telefone.length <= 6 && telefone.length > 15) {
      alert("Telefone invalido!")
    }
    else {
   //   setInterval(sumirMensagem, 5000)
    }

    // Enviando o valor da nova input
    fetch("/maquina/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        cpuServer: cpu,
        ramServer: ram,
        discoServer: disco,
        serialServer: serial,
      })
    }).then(function (resposta) {
      console.log("resposta: ", resposta);
      if (resposta.ok) {
        cardErro.style.display = "block";
        mensagem_erro.innerHTML = "Cadastro realizado com sucesso! Redirecionando para tela de Login...";
        setTimeout(() => {
          window.location = "Login-Madara.html";
        }, "2000")

      //  limparFormulario();
       // finalizarAguardar();
      } else {
        throw ("Houve um erro ao tentar realizar o cadastro!");

      }
    }).catch(function (resposta) {
      console.log(`#ERRO: ${resposta}`);
     // finalizarAguardar();
    });

    return false;
  }



  function aparecerBuscados() {
    alterarMaq2.style.display = "block";
    alterarMaq.style.height = "15%";


    var cnpj = Alt_cnpj.value;

    console.log(cnpj);

    if (cnpj.value == "") {

      if (cnpj.value == "") {
        alert(`Preencha o campo cnpj!`)
      }

    //  finalizarAguardar();
      return false;
    }
    else {
    //  setInterval(sumirMensagem, 5000)
    }

    console.log("FORM cnpj: ", cnpj);

    fetch("/empresa/pegarEmpresa", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        cnpjAltServer: cnpj,
      })
    }).then(function (resposta) {
      console.log("ESTOU NO THEN DO aparecerBuscados()!")

      if (resposta.ok) {
        console.log(resposta);

        resposta.json().then(json => {
          console.log(json);
          console.log(JSON.stringify(json));

          sessionStorage.ID_USUARIO = json.id;
          sessionStorage.CNPJ_USUARIO = json.cnpj;
          sessionStorage.RAZAOSOCIAL_USUARIO = json.razaoSocial;
          sessionStorage.RESPONSAVEL_USUARIO = json.responsavel;
          sessionStorage.EMAIL_USUARIO = json.email;
          sessionStorage.TELEFONEUSUARIO = json.telefone;

          console.log(sessionStorage.CNPJ_USUARIO);
        });

      } else {
        alert("Email ou senha invalidos!")

        console.log("Houve um erro ao tentar realizar o login!");

        resposta.text().then(texto => {
          console.error(texto);
      //    finalizarAguardar(texto);
        });
      }

    }).catch(function (erro) {
      console.log(erro);
    })

    return false;
  }
</script>