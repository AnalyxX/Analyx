<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>empresa</title>
  <link rel="stylesheet" href="../assets/css/empresa/empresa.css" />
</head>

<body>
  <section>

    <div class="navBarLateral">
      <div class="user">
        <h2 id="NomeUsuario"></h2>
      </div>

      <div class="navegarLeteral">
        <li id="aqui">EMPRESA</li>
        <li> <a href="../crud_maquina/maquina.html"> MÁQUINA</a></li>
        <li><a href="../crud_funcionario/funcionario.html">FUNCIONÁRIO</a></li>
        <li><a href="../crud_usuario/usuario.html"> USUÁRIO</a></li>
      </div>
      <div class="sair" onclick="sair()"><span>Voltar</span></div>
    </div>

    <div class="areaPrincipal">
      <header>
        <nav>
          <ul>
            <li id="cadEMP" style="display:none"><a onclick="cadastrarEMP()">Cadastrar Empresa</a></li>
            <li id="aqui2"><a style="display:block">Cadastrar Empresa</a></li>
            <li id="altEmp" style="display: block;"><a onclick="alterarEMP()"> Alterar Empresa</a></li>
            <li id="aqui3" style="display: none;"><a>Alterar Empresa</a></li>
            <li id="listEmp" style="display: none;"><a onclick="listarEMP()">Listar Empresa</a></li>
            <li id="aqui4" style="display: none;"><a>Listar Empresa</a></li>
            <li id="deletEmp" style="display: none;"><a onclick="deletarEMP()">Deletar Empresa</a></li>
            <li id="aqui5" style="display: none;"><a>Deletar Empresa</a></li>
          </ul>
        </nav>
      </header>

      <div class="areaTitulo">

        <div id="tituloCAD" class="titulo">
          <h1>Cadastro Empresa</h1>
        </div>

        <div id="tituloALT" class="titulo" style="display: none;">
          <h1>Buscar Empresa</h1>
        </div>
        <div id="tituloLIST" class="titulo" style="display: none;">
          <h1>Listagem de Empresas</h1>
        </div>
        <div id="tituloDELET" class="titulo" style="display: none;">
          <h1>Deletar Empresa</h1>
        </div>
        <div class="menssagem" id="menssagem">

        </div>

      </div>


      <div id="cadastroEmp" class="cadastro-emp" style="display:block;">
        <div class="input" id="ipt-1">
          CNPJ
          <input type="number" name="nome" id="ipt_cnpj" />
        </div>
        <div class="input" id="ipt-2">
          Razão social
          <input type="text" name="matricula" id="ipt_razaoSocial" />
        </div>
        <div class="input" id="ipt-3">
          Responsavel
          <input type="text" name="setor" id="ipt_responsavel" />
        </div>
        <div class="input" id="ipt-4">
          E-mail
          <input type="text" name="maquina" id="ipt_email" />
        </div>
        <div class="input" id="ipt-5">
          Telefone
          <input type="number" name="funcao" id="ipt_telefone" />
        </div>
        <button id="btn_entrar" onclick="cadastrar2()">Cadastrar</button>
      </div>


      <div id="alterarEmp" class="alterar-emp" style="display:none;">
        <div class="input2" id="ipt-1">
          CNPJ:
          <input type="number" name="nome" id="Alt_cnpj" />
          <button id="btn_entrar" onclick="aparecerBuscados()">Buscar</button>
        </div>
      </div>


      <div id="alterarEmp2" class="alterar-emp2" style="display:none;">
        <div class="input3" id="ipt-1">
          CNPJ
          <input type="text" name="nome" placeholder="Altere o CNPJ" id="alt_cnpj" />
        </div>
        <div class="input3" id="ipt-2">
          Razão social
          <input type="text" name="matricula" placeholder="Altere a Razão Social" id="alt_razao" />
        </div>
        <div class="input3" id="ipt-3">
          Responsavel
          <input type="text" name="setor" placeholder="Altere o Responsável" id="alt_responsavel" />
        </div>
        <div class="input3" id="ipt-4">
          E-mail
          <input type="text" name="maquina" placeholder="Altere o Email" id="alt_email" />
        </div>
        <div class="input3" id="ipt-5">
          Telefone
          <input type="text" name="funcao" placeholder="Altere o Telefone" id="alt_telefone" />
        </div>
        <button id="btn_entrar" onclick="alterar()">Alterar</button>
      </div>


      <div class="listar" style="display: none;" id="listar">
        <div class="listar2" id="listar2">
          <div id="listarEmp" class="listar-emp" style="display:none;">
            <div class="input" id="ipt-1">
              Foram encontradas:
            </div>
            <div id="empresas_lista">

            </div>

          </div>

          <div id="listarEmp2" class="listar-emp2">
            <div class="input" id="ipt-1">
              CNPJ
              <input type="text" name="nome" id="list_cnpj" readonly />
              <div class="input" id="ipt-2">
                Razão social
                <input type="text" name="matricula" id="list_razaoSocial" readonly />
              </div>
              <div class="input" id="ipt-3">
                Responsavel
                <input type="text" name="setor" id="list_responsavel" readonly />
              </div>
              <div class="input" id="ipt-4">
                E-mail
                <input type="text" name="maquina" id="list_email" readonly />
              </div>
              <div class="input" id="ipt-5">
                Telefone
                <input type="text" name="funcao" id="list_telefone" readonly />
              </div>
            </div>
          </div>
        </div>
      </div>


      <div id="deletarEmp" class="deletar-emp" style="display:none;">
        <div id="buscarDelete" style="display:block;">
          <div class="input" id="ipt-1">
            CNPJ
            <input type="text" name="nome" id="Delet_cnpj" />
          </div>
          <button id="btn_entrar" onclick="aparecerDelete()">Procurar</button>
        </div>

        <div id="deletarEmp2" class="deletarEmp2" style="display:none;">
          <h3>Tem certeza que deseja excluir essa empresa ?</h3>
          <li>CNPJ:<span id="del_cnpj"></span></li>
          <li>Razão social:<span id="del_razaoSocial"></span></li>
          <li>Responsável:<span id="del_responsavel"></span></li>
          <li>E-mail:<span id="del_email"></span></li>
          <li>Telefone:<span id="del_telefone"></span></li>
          <div class="SimNao">
            <li onclick="deletar()">Sim</li>
            <li onclick="voltar()">Não</li>
          </div>
        </div>
      </div>
    </div>



  </section>
</body>

</html>
<script>
  var EmailUsuario = "";
  var NomeDousuario = "";


  EmailUsuario = sessionStorage.EMAIL_USUARIO;

  NomeUsuario.innerHTML = sessionStorage.NOME_USUARIO;



  if (EmailUsuario == undefined || !(EmailUsuario.includes("analyx@"))) {
    window.location = "../crud_maquina/maquina.html";
  }

  console.log(EmailUsuario);
  if (EmailUsuario && EmailUsuario.includes("analyx@")) {
    listEmp.style.display = "block";
    deletEmp.style.display = "block";
  }

  function sair() {
    window.location = "../dashboard/dashboard-init.html";
    sessionStorage.clear();

  }

  function teste() {
    menssagem.style.display = "block";
    menssagem.innerHTML = "Cadastrado com sucesso!";
    setTimeout(() => {
      menssagem.style.display = "none";
    }, "4000")
  }


  function cadastrarEMP() {
    if (EmailUsuario && EmailUsuario.includes("analyx@")) {
      //header
      aqui3.style.display = "none";
      aqui4.style.display = "none";
      aqui5.style.display = "none";
      cadEMP.style.display = "none";

      altEmp.style.display = "block";
      listEmp.style.display = "block";
      deletEmp.style.display = "block";

      aqui2.style.display = "block";

      //social
      alterarEmp.style.display = "none";
      listarEmp.style.display = "none";
      deletarEmp.style.display = "none";
      alterarEmp2.style.display = "none";
      listar.style.display = "none";

      cadastroEmp.style.display = "block";

      //titulo
      tituloCAD.style.display = "block";
      tituloALT.style.display = "none";
      tituloLIST.style.display = "none";
      tituloDELET.style.display = "none";
    } else {
      //header
      aqui3.style.display = "none";
      aqui4.style.display = "none";
      aqui5.style.display = "none";
      cadEMP.style.display = "none";

      altEmp.style.display = "block";
      listEmp.style.display = "none";
      deletEmp.style.display = "none";

      aqui2.style.display = "block";

      //social
      alterarEmp.style.display = "none";
      listarEmp.style.display = "none";
      deletarEmp.style.display = "none";
      alterarEmp2.style.display = "none";

      cadastroEmp.style.display = "block";

      //titulo
      tituloCAD.style.display = "block";
      tituloALT.style.display = "none";
      tituloLIST.style.display = "none";
      tituloDELET.style.display = "none";
    }
  }
  function alterarEMP() {
    if (EmailUsuario && EmailUsuario.includes("analyx@")) {
      //header
      aqui2.style.display = "none";
      aqui4.style.display = "none";
      aqui5.style.display = "none";
      altEmp.style.display = "none";

      deletEmp.style.display = "block";
      listEmp.style.display = "block";
      cadEMP.style.display = "block";

      aqui3.style.display = "block";

      //social
      cadastroEmp.style.display = "none";
      listarEmp.style.display = "none";
      deletarEmp.style.display = "none";
      alterarEmp2.style.display = "none";
      listar.style.display = "none";


      alterarEmp.style.display = "block";

      //titulo
      tituloCAD.style.display = "none";
      tituloALT.style.display = "block";
      tituloLIST.style.display = "none";
      tituloDELET.style.display = "none";
    } else {
      //header
      aqui2.style.display = "none";
      aqui4.style.display = "none";
      aqui5.style.display = "none";
      altEmp.style.display = "none";

      deletEmp.style.display = "none";
      listEmp.style.display = "none";
      cadEMP.style.display = "block";

      aqui3.style.display = "block";

      //social
      cadastroEmp.style.display = "none";
      alterarEmp2.style.display = "none";
      listar.style.display = "none";


      alterarEmp.style.display = "block";

      //titulo
      tituloCAD.style.display = "none";
      tituloALT.style.display = "block";
    }

  }

  function listarEMP() {
    //header
    aqui2.style.display = "none";
    aqui3.style.display = "none";
    aqui5.style.display = "none";
    listEmp.style.display = "none";

    cadEMP.style.display = "block";
    altEmp.style.display = "block";
    deletEmp.style.display = "block";

    aqui4.style.display = "block";


    //social
    cadastroEmp.style.display = "none";
    alterarEmp.style.display = "none";
    deletarEmp.style.display = "none";
    alterarEmp2.style.display = "none";


    listarEmp.style.display = "block";
    // listarEmp2.style.position = "absolute";
    listar.style.display = "block";

    //titulo
    tituloCAD.style.display = "none";
    tituloALT.style.display = "none";
    tituloLIST.style.display = "block";
    tituloDELET.style.display = "none";
  }

  function deletarEMP() {
    //header
    aqui2.style.display = "none";
    aqui3.style.display = "none";
    aqui4.style.display = "none";
    deletEmp.style.display = "none";

    cadEMP.style.display = "block";
    altEmp.style.display = "block";
    listEmp.style.display = "block";

    aqui5.style.display = "block";

    //social
    cadastroEmp.style.display = "none";
    alterarEmp.style.display = "none";
    listarEmp.style.display = "none";
    alterarEmp2.style.display = "none";
    listar.style.display = "none";



    deletarEmp.style.display = "block";


    //titulo
    tituloCAD.style.display = "none";
    tituloALT.style.display = "none";
    tituloLIST.style.display = "none";
    tituloDELET.style.display = "block";

  }
  var ax_erro = false;
  function cadastrar2() {
    var cnpj = ipt_cnpj.value;

    fetch("/empresa/autenticarEMP", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        cnpjServer: cnpj,
      })
    }).then(function (resposta) {
      console.log("ESTOU NO THEN DO entrar()!")

      if (resposta.ok) {
        console.log(resposta);

        resposta.json().then(json => {
          console.log(json);
          console.log(JSON.stringify(json));

          if (json === false) {
            alert("Já existe uma empresa com o mesmo CNPJ!");
            ax_erro = true;
            return;
          } else {
            ax_erro = false;
            cadastrar();
          }


        });

      } else {

        console.log("Houve um erro ao tentar realizar o cadastro!");
        ax_erro = true;
        alert("Essa empresa já está cadastrada!")
        return;

        resposta.text().then(texto => {
          console.error(texto);
        });
      }

    }).catch(function (erro) {
      console.log(erro);
      ax_erro = true;

    })
    ax_erro = true;
  }

  function cadastrar() {
    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo
    var cnpj = ipt_cnpj.value;
    var razaoSocial = ipt_razaoSocial.value;
    var responsavel = ipt_responsavel.value;
    var email = ipt_email.value;
    var telefone = ipt_telefone.value;
    // var ax_erro = false


    if (cnpj == "" || razaoSocial == "" || responsavel == "" || email == "" || telefone == "") {
      //cardErro.style.display = "block"
      alert("Por favor, preencha todos os campos!")
      ax_erro = true;
    } else if (ipt_cnpj.value.length > 17 || ipt_cnpj.value.length < 7) {
      alert("CNPJ invalido!")
      ax_erro = true;
    } else if (email.indexOf('@') == -1) {
      alert("Email invalido! insira um email com @.")
      ax_erro = true;
    } else if (email.length <= 10) {
      alert("Email invalido! Insira um email maior.")
      ax_erro = true;
    } else if (razaoSocial.length <= 2 && razaoSocial.length >= 25) {
      alert("Razao social não pode ser muito curta ou muito longa")
      ax_erro = true;
    } else if (responsavel.length < 3 && responsavel.length > 25) {
      alert("Razao social não pode ser muito curta ou muito longa!")
      ax_erro = true;
    } else if (email.length < 6) {
      alert("Email muito curto!")
      ax_erro = true;
    } else if (telefone.length <= 6 && telefone.length >= 14) {
      alert("Telefone invalido!")
      ax_erro = true;

    }

    if (ax_erro == false) {



      fetch("/empresa/cadastrar", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          cnpjServer: cnpj,
          razaoServer: razaoSocial,
          responsavelServer: responsavel,
          emailServer: email,
          telefoneServer: telefone
        })
      }).then(function (resposta) {
        console.log("resposta: ", resposta);
        if (resposta.ok) {

          menssagem.style.display = "block";
          menssagem.innerHTML = "Cadastro realizado com sucesso!";
          setTimeout(() => {
            menssagem.style.display = "none";
          }, "4000")
          setTimeout(() => {
            window.location = "empresa.html";
          }, "2000")


        } else {
          throw ("Houve um erro ao tentar realizar o cadastro!");
        }
      }).catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
      return false;
    }
  }

  function aparecerBuscados() {


    var cnpj = Alt_cnpj.value;

    console.log(cnpj);

    if (cnpj == "") {

      alert(`Preencha o campo cnpj!`)

      return false;
    }

    console.log("FORM cnpj: ", cnpj);

    fetch("/empresa/pegarEmpresa", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        cnpjAltServer: cnpj,
      })
    }).then(function (resposta) {
      console.log("ESTOU NO THEN DO aparecerBuscados()!")



      if (resposta.ok) {
        console.log(resposta);

        if (resposta.status == 204) {
          alert("Nenhuma empresa encontrada!")
        } else {

          resposta.json().then(json => {
            console.log(json);
            console.log(JSON.stringify(json));

            sessionStorage.ID_EMPRESACAD = json.id;
            sessionStorage.CNPJ_EMPRESACAD = json.cnpj;
            sessionStorage.RAZAOSOCIAL_EMPRESACAD = json.razaoSocial;
            sessionStorage.RESPONSAVEL_EMPRESACAD = json.responsavel;
            sessionStorage.EMAIL_EMPRESACAD = json.email;
            sessionStorage.TELEFONE_EMPRESACAD = json.telefone;

            alt_cnpj.value = sessionStorage.CNPJ_EMPRESACAD;
            alt_razao.value = sessionStorage.RAZAOSOCIAL_EMPRESACAD;
            alt_responsavel.value = sessionStorage.RESPONSAVEL_EMPRESACAD;
            alt_email.value = sessionStorage.EMAIL_EMPRESACAD;
            alt_telefone.value = sessionStorage.TELEFONE_EMPRESACAD;

            if (sessionStorage.CNPJ_EMPRESACAD != null && sessionStorage.CNPJ_EMPRESACAD != undefined) {
              alert("Empresa encontrada!")
            }


            alterarEmp2.style.display = "block";
            alterarEmp.style.height = "15%";
            console.log(sessionStorage.CNPJ_USUARIO);
          });
        }

      } else {

        console.log("Houve um erro ao tentar procurar a empresa!");

        resposta.text().then(texto => {
          console.error(texto);
          //    finalizarAguardar(texto);
        });
      }

    }).catch(function (erro) {
      alert("Empresa não encontrada!")
      console.log(erro);
    })

    return false;
  }


  function alterar() {
    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo
    var cnpjNovo = alt_cnpj.value;
    var razaoSocialNovo = alt_razao.value;
    var responsavelNovo = alt_responsavel.value;
    var emailNovo = alt_email.value;
    var telefoneNovo = alt_telefone.value;
    var id = sessionStorage.ID_EMPRESACAD;
    console.log(id);
    var ax_erro = false;


    if (alt_cnpj.value == "" || alt_razao.value == "" || alt_responsavel.value == "" || alt_email.value == ""
      || alt_telefone.value == "") {
      //cardErro.style.display = "block"
      alert("Por favor, preencha todos os campos!")
      if (ipt_nome.length > 10) {
        alert("Escreva um nome mais curto")
      }


      return false;
    } else if (alt_cnpj.value.length < 10) {
      alert("CNPJ invalido!")
      return false;
    } else if (!emailNovo || emailNovo.indexOf('@') == -1 || emailNovo.length <= 10) {
      alert("Insira um email válido com @ ou mais longo!");
      return false;
    } else if (razaoSocialNovo.length <= 2 || razaoSocialNovo.length >= 25) {
      alert("Razao social não pode ser muito curta ou muito longa")
      return false;
    } else if (responsavelNovo.length < 3 || responsavelNovo.length > 25) {
      alert("Razao social não pode ser muito curta ou muito longa!")
      return false;
    } else if (emailNovo.length < 6) {
      alert("Email muito curto!")
      return false;
      return false;
    } else if (telefoneNovo.length <= 6 && telefoneNovo.length >= 14) {
      alert("Telefone invalido!")
      return false;
    } else if (alt_cnpj.value == sessionStorage.CNPJ_EMPRESACAD && alt_razao.value == sessionStorage.RAZAOSOCIAL_EMPRESACAD
      && alt_responsavel.value == sessionStorage.RESPONSAVEL_EMPRESACAD && alt_email.value == sessionStorage.EMAIL_EMPRESACAD
      && alt_telefone.value == sessionStorage.TELEFONE_EMPRESACAD) {
      alert("Nenhuma alteração feita!")
      return false;
    }
    else {
      fetch("/empresa/alterar", {
        method: "PUT",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          cnpjnovoServer: cnpjNovo,
          razaonovoServer: razaoSocialNovo,
          responsavelnovoServer: responsavelNovo,
          emailnovoServer: emailNovo,
          telefonenovoServer: telefoneNovo,
          idServer: id,
        })
      }).then(function (resposta) {
        console.log("resposta: ", resposta);
        if (resposta.ok) {
          menssagem.style.display = "block";
          menssagem.innerHTML = "Alteração realizada com sucesso!";
          setTimeout(() => {
            menssagem.style.display = "none";
          }, "4000")
          alt_cnpj.value = "";
          alt_email.value = "";
          alt_razao.value = "";
          alt_responsavel.value = "";
          alt_telefone.value = "";
          setTimeout(() => {
            window.location = "empresa.html";
          }, "2000")

        } else {
          throw ("Houve um erro ao tentar realizar a alteração!");
          menssagem.style.display = "block";
          menssagem.innerHTML = "Houve um erro ao realizar a alteração!";
          setTimeout(() => {
            menssagem.style.display = "none";
          }, "4000")

        }
      }).catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });

      return false;
    }

  }


  var informacaoList = -1;
  function listEmpresa(i) {
    informacaoList = i;
    listagemEmpresas();

  }
  var listarUmaVez = false;

  listagemEmpresas();

  function listagemEmpresas() {

    fetch("/empresa/listar", {
      method: "GET",
      headers: {
        "Content-Type": "application/json"
      },
    }).then(function (resposta) {
      console.log("ESTOU NO THEN DO aparecerBuscados()!")

      if (resposta.ok) {
        console.log(resposta);

        resposta.json().then(json => {
          console.log(json);
          console.log(JSON.stringify(json));

          sessionStorage.CNPJ_EMPRESA = json.cnpj;
          console.log(json.length);


          if (listarUmaVez == false) {
            for (i = 0; i < json.length; i++) {
              var registro = json[i];
              empresas_lista.innerHTML += `<li onclick="listEmpresa(${i})">${registro.cnpj}</li>`;
              listarUmaVez = true;
            }
          }

          for (i = 0; i < json.length; i++) {
            var registro = json[i];
            if (informacaoList >= 0) {
              if (i == informacaoList) {
                list_cnpj.value = `${registro.cnpj}`;
                list_razaoSocial.value = `${registro.razaoSocial}`;
                list_responsavel.value = `${registro.responsavel}`;
                list_telefone.value = `${registro.telefone}`;
                list_email.value = `${registro.email}`;
              }

            }

          }


          if (sessionStorage.CNPJ_EMPRESA != null && sessionStorage.CNPJ_EMPRESA != undefined) {
            // alert("Empresa encontrada!")
          } else {
            //   alert("empresa null ou undefined")
          }
        });

      } else {
        console.log("Houve um erro ao tentar encontrar empresas!");
        resposta.text().then(texto => {
          console.error(texto);
        });
      }

    }).catch(function (erro) {
      console.log(erro);
    })

    return false;
  }




  function aparecerDelete() {

    var cnpj = Delet_cnpj.value;

    console.log(cnpj);

    if (cnpj.value == "") {

      alert(`Preencha o campo cnpj!`)

      return false;
    }

    console.log("FORM cnpj: ", cnpj);

    fetch("/empresa/pegarEmpresa", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        cnpjAltServer: cnpj,
      })
    }).then(function (resposta) {
      console.log("ESTOU NO THEN DO aparecerBuscados()!")

      if (resposta.ok) {
        console.log(resposta);

        if (resposta.status == 204) {
          alert("Nenhuma empresa encontrada!")
        } else {
          resposta.json().then(json => {
            console.log(json);
            console.log(JSON.stringify(json));
            deletarEmp2.style.display = "block";
            buscarDelete.style.display = "none";

            sessionStorage.ID_EMPRESADEL = json.id;
            sessionStorage.CNPJ_EMPRESADEL = json.cnpj;
            sessionStorage.RAZAOSOCIAL_EMPRESADEL = json.razaoSocial;
            sessionStorage.RESPONSAVEL_EMPRESADEL = json.responsavel;
            sessionStorage.EMAIL_EMPRESADEL = json.email;
            sessionStorage.TELEFONE_EMPRESADEL = json.telefone;

            del_cnpj.innerHTML = sessionStorage.CNPJ_EMPRESADEL;
            del_razaoSocial.innerHTML = sessionStorage.RAZAOSOCIAL_EMPRESADEL;
            del_responsavel.innerHTML = sessionStorage.RESPONSAVEL_EMPRESADEL;
            del_email.innerHTML = sessionStorage.EMAIL_EMPRESADEL;
            del_telefone.innerHTML = sessionStorage.TELEFONE_EMPRESADEL;


            if (sessionStorage.CNPJ_USUARIO != null && sessionStorage.CNPJ_USUARIO != undefined) {
              alert("Empresa encontrada!")
            }

          });
        }
      } else {
        alert("Email ou senha invalidos!")

        console.log("Houve um erro ao tentar realizar o login!");

        resposta.text().then(texto => {
          console.error(texto);
          //    finalizarAguardar(texto);
        });
      }
    }).catch(function (erro) {
      console.log(erro);
      alert("Empresa não encontrada")
    })

    return false;
  }


  function deletar() {
    deletarEmp2.style.display = "block";
    buscarDelete.style.display = "none";

    var id = sessionStorage.ID_EMPRESADEL;

    if (id == "") {

      return false;
    }


    console.log("FORM id: ", id);

    fetch("/empresa/deletar", {
      method: "DELETE",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        idServer: id,
      })
    }).then(function (resposta) {
      console.log("ESTOU NO THEN DO DELETAR!")

      if (resposta.ok) {
        console.log(resposta);


        menssagem.style.display = "block";
        menssagem.innerHTML = "Empresa deletada com sucesso!";
        setTimeout(() => {
          menssagem.style.display = "none";
        }, "4000")
        setTimeout(() => {
          window.location = "empresa.html";
        }, "2000")
          ;

      } else {
        alert("Ops! há um erro no sistema, já estamos tentando resolver.")

        console.log("Houve um erro ao tentar deletar!");

        resposta.text().then(texto => {
          console.error(texto);
        });
      }
    }).catch(function (erro) {
      console.log(erro);
    })

    return false;
  }

  function voltar() {
    deletarEmp2.style.display = "none";
    buscarDelete.style.display = "block";
  }
</script>